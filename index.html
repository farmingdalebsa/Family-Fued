<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BSA Family Feud Night</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 UMD + Babel (so we can write JSX in-browser) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="min-h-screen bg-emerald-950">
    <div id="root"></div>

    <!-- Custom reveal sound: put your file at sounds/reveal.mp3 -->
    <audio id="reveal-audio" src="sounds/reveal.mp3" preload="auto"></audio>

    <script type="text/babel" data-presets="react">
      const { useMemo, useState, useEffect, useRef } = React;

      // First 21 questions from your file; last 4 kept from before.
      const SAMPLE_QUESTIONS = [
        // 1
        { prompt: "Tell us a reason students are late to class", answers: [
          { text: "Overslept", points: 35 },
          { text: "Missed the bus / no ride", points: 25 },
          { text: "Traffic / parking", points: 20 },
          { text: "Getting food or coffee", points: 10 },
          { text: "Talking with friends", points: 5 },
          { text: "Forgot class time", points: 5 },
        ]},
        // 2
        { prompt: "Name something you’ll find in a student’s backpack", answers: [
          { text: "Laptop", points: 30 },
          { text: "Notebook", points: 25 },
          { text: "Charger", points: 15 },
          { text: "Snacks", points: 10 },
          { text: "Pens/Pencils", points: 10 },
          { text: "Water Bottle", points: 10 },
        ]},
        // 3
        { prompt: "If you could represent yourself as a South Asian spice, what spice are you?", answers: [
          { text: "Chili", points: 39 },
          { text: "Garam Masala", points: 24 },
          { text: "Cinnamon", points: 17 },
          { text: "Black pepper", points: 13 },
          { text: "Cardamom", points: 7 },
        ]},
        // 4
        { prompt: "Place where South Asian students hang out on campus", answers: [
          { text: "Quintyne Hall", points: 38 },
          { text: "Library", points: 23 },
          { text: "FSC Circle", points: 19 },
          { text: "Cafeteria", points: 14 },
          { text: "Parking lot", points: 6 },
        ]},
        // 5 (points not in doc — using standard descending so the game runs)
        { prompt: "Name one worst place to be on first day of class", answers: [
          { text: "Jail", points: 30 },
          { text: "Still on vacation", points: 25 },
          { text: "Wrong classroom", points: 20 },
          { text: "Still in bed", points: 15 },
          { text: "Getting pulled over", points: 10 },
        ]},
        // 6
        { prompt: "Name a popular MSA, PSA, SASA, ASA, BSA event", answers: [
          { text: "Formal Night", points: 38 },
          { text: "Eid Banquet", points: 25 },
          { text: "Game Night", points: 19 },
          { text: "Iftar Banquet", points: 10 },
          { text: "Family Feud / Trivia", points: 8 },
        ]},
        // 7
        { prompt: "What animal noise can you make?", answers: [
          { text: "Dog - Woof Woof", points: 37 },
          { text: "Cat - Meow", points: 27 },
          { text: "Cow - Hambaaa", points: 19 },
          { text: "Lion - Roar", points: 10 },
          { text: "Chicken - Kuk-ru-kuuuuu", points: 7 },
        ]},
        // 8
        { prompt: "Name a place where Farmingdale students go for dates", answers: [
          { text: "Qawah House / Filli", points: 39 },
          { text: "Restaurants", points: 28 },
          { text: "Library", points: 21 },
          { text: "Campus Garden", points: 8 },
          { text: "Shopping Mall", points: 4 },
        ]},
        // 9
        { prompt: "Name a South Asian street food", answers: [
          { text: "Fuchka / Pani Puri", points: 48 },
          { text: "Chaat", points: 28 },
          { text: "Samosa", points: 15 },
          { text: "Pakora", points: 5 },
          { text: "Roll", points: 4 },
        ]},
        // 10
        { prompt: "What do students do before exam", answers: [
          { text: "Cram all night", points: 35 },
          { text: "Drink coffee", points: 25 },
          { text: "Pray", points: 15 },
          { text: "Panic", points: 15 },
          { text: "Group study", points: 10 },
        ]},
        // 11
        { prompt: "You’re having a friends sleepover; not enough space — where do you suggest your fat friend sleep?", answers: [
          { text: "Bathroom", points: 30 },
          { text: "Kitchen", points: 25 },
          { text: "Living room", points: 15 },
          { text: "Garage", points: 10 },
          { text: "Closet", points: 10 },
        ]},
        // 12
        { prompt: "Name a reason why students get expelled from college", answers: [
          { text: "Bad performance", points: 33 },
          { text: "Drugs/Drinking", points: 26 },
          { text: "Plagiarism", points: 21 },
          { text: "Violence", points: 12 },
          { text: "Harassment", points: 8 },
        ]},
        // 13
        { prompt: "Name a reason why students join clubs", answers: [
          { text: "Free food", points: 33 },
          { text: "Fun events", points: 26 },
          { text: "Make new friends", points: 21 },
          { text: "Watch drama/fights", points: 12 },
          { text: "Leadership opportunities", points: 8 },
        ]},
        // 14
        { prompt: "What’s the weirdest thing someone might bring to class", answers: [
          { text: "Pajamas and a blanket", points: 28 },
          { text: "Your pet in backpack", points: 24 },
          { text: "Their mom", points: 19 },
          { text: "A stinky meal from home", points: 16 },
          { text: "Toothbrush", points: 13 },
        ]},
        // 15
        { prompt: "Name something you do during summer break", answers: [
          { text: "Travel", points: 35 },
          { text: "Go to the beach", points: 25 },
          { text: "Sleep", points: 18 },
          { text: "Work / Internship", points: 14 },
          { text: "Hang out with friends", points: 8 },
        ]},
        // 16
        { prompt: "What’s something students do instead of studying?", answers: [
          { text: "Binge-watch Netflix", points: 33 },
          { text: "Scroll TikTok for 3 hours", points: 26 },
          { text: "Nap everywhere", points: 21 },
          { text: "Playing video games", points: 12 },
          { text: "Daydreaming", points: 8 },
        ]},
        // 17
        { prompt: "Name a lie students tell themselves every semester", answers: [
          { text: "I’m going to class every day", points: 35 },
          { text: "I’m only using my phone for notes", points: 25 },
          { text: "I won’t pull an all-nighter again", points: 19 },
          { text: "I don’t need coffee to survive", points: 12 },
          { text: "I will start study from tomorrow", points: 9 },
        ]},
        // 18
        { prompt: "Name an expectation from your family after graduating", answers: [
          { text: "Become a doctor/engineer/lawyer", points: 33 },
          { text: "Get married ASAP", points: 27 },
          { text: "Start making big money", points: 18 },
          { text: "Buy parents a house or car", points: 15 },
          { text: "Support younger siblings", points: 7 },
        ]},
        // 19
        { prompt: "Hardest class students complain about in Farmingdale", answers: [
          { text: "Math", points: 33 },
          { text: "Programming / Java", points: 26 },
          { text: "Physics", points: 21 },
          { text: "Statistics", points: 12 },
          { text: "Public Speaking/Art/Language", points: 8 },
        ]},
        // 20
        { prompt: "Give me bad word that describes Arefin", answers: [
          { text: "Dumbass", points: 28 },
          { text: "Mouthbambbler", points: 24 },
          { text: "Bolod", points: 19 },
          { text: "Delusional/crazy", points: 16 },
          { text: "Annoying/Loud", points: 13 },
        ]},
        // 21
        { prompt: "Give me good word that describes Arefin", answers: [
          { text: "Handsome", points: 37 },
          { text: "Dashing", points: 27 },
          { text: "Funny", points: 19 },
          { text: "Caring", points: 10 },
          { text: "Helpful", points: 7 },
        ]},

        /* 22–25 kept as before */
        { prompt: "Something people do at Eid prayer", answers: [
          { text: "Say Eid Mubarak", points: 26 },
          { text: "Shake hands/hug", points: 22 },
          { text: "Wear new clothes", points: 18 },
          { text: "Donate (Zakat)", points: 14 },
          { text: "Take photos", points: 10 },
        ]},
        { prompt: "A traditional Bangladeshi game", answers: [
          { text: "Kabaddi", points: 28 },
          { text: "Gollachut", points: 22 },
          { text: "Danguli", points: 18 },
          { text: "Ludo", points: 14 },
          { text: "Carrom", points: 10 },
        ]},
        { prompt: "Something Bangladeshi students miss from home", answers: [
          { text: "Family", points: 28 },
          { text: "Home food", points: 24 },
          { text: "Friends", points: 18 },
          { text: "Festivals", points: 14 },
          { text: "Weather", points: 10 },
        ]},
        { prompt: "A Bangladeshi word Americans often mispronounce", answers: [
          { text: "Dhaka", points: 26 },
          { text: "Sylhet", points: 22 },
          { text: "Chittagong", points: 18 },
          { text: "Pohela Boishakh", points: 14 },
          { text: "Ilish", points: 10 },
        ]},
      ];

      function FamilyFeudLite() {
        const [teamAName, setTeamAName] = useState("Team Padma");
        const [teamBName, setTeamBName] = useState("Team Meghna");
        const [scoreA, setScoreA] = useState(0);
        const [scoreB, setScoreB] = useState(0);

        const [questions, setQuestions] = useState(SAMPLE_QUESTIONS);
        const [roundIndex, setRoundIndex] = useState(0);

        // Per-round reveal & scoring
        const [revealed, setRevealed] = useState([]);   // which tiles are visible
        const [scored, setScored] = useState([]);       // which tiles already added to mainScore
        const [mainScore, setMainScore] = useState(0);  // MAIN SCOREBOARD (current round)

        const [strikes, setStrikes] = useState(0);
        const [multiplier, setMultiplier] = useState(1);
        const [editingQuestions, setEditingQuestions] = useState(false);
        const [jsonDraft, setJsonDraft] = useState(() => JSON.stringify(SAMPLE_QUESTIONS, null, 2));
        const [questionHidden, setQuestionHidden] = useState(true);
        const [isRevealingAll, setIsRevealingAll] = useState(false);

        // Reveal sound
        const revealAudioRef = useRef(null);
        useEffect(() => {
          revealAudioRef.current = document.getElementById("reveal-audio");
        }, []);
        function playReveal(delayMs = 0, volume = 1) {
          const el = revealAudioRef.current;
          if (!el) return;
          const node = el.cloneNode(true);
          node.volume = volume;
          setTimeout(() => { node.play().catch(() => {}); }, delayMs);
        }
        function sleep(ms) { return new Promise(res => setTimeout(res, ms)); }

        const current = questions[roundIndex];

        // Initialize new round
        useEffect(() => {
          if (!current) return;
          const n = current.answers.length;
          setRevealed(Array(n).fill(false));
          setScored(Array(n).fill(false));
          setMainScore(0);
          setStrikes(0);
          setMultiplier(1);
          setQuestionHidden(true);
          setIsRevealingAll(false);
        }, [roundIndex, questions]);

        const totalPossible = useMemo(() => {
          if (!current) return 0;
          return current.answers.reduce((s, a) => s + a.points, 0);
        }, [current]);

        // Single tile reveal: adds points to Main Scoreboard (once per tile), honors multiplier
        function handleReveal(i) {
          if (questionHidden || isRevealingAll) return;
          if (!revealed[i]) {
            setRevealed(prev => {
              const next = [...prev];
              next[i] = true;
              return next;
            });
            setScored(prev => {
              if (!prev[i]) {
                setMainScore(ms => ms + current.answers[i].points * multiplier);
                const next = [...prev];
                next[i] = true;
                return next;
              }
              return prev;
            });
            playReveal(0, 0.95);
          }
        }

        // Reveal all sequentially: NO scoring, just reveal + sound
        async function revealAllSequential() {
          if (!current || isRevealingAll) return;
          setIsRevealingAll(true);
          setQuestionHidden(false);

          const toReveal = current.answers.map((_, i) => i).filter(i => !revealed[i]);
          for (const idx of toReveal) {
            setRevealed(prev => {
              const next = [...prev];
              next[idx] = true;
              return next;
            });
            // No scored/mainScore changes here
            playReveal(0, 0.95);
            await sleep(250); // change to 3000 for a 3s delay
          }
          setIsRevealingAll(false);
        }

        function toggleRevealAll(state) {
          if (!current) return;
          if (state) {
            revealAllSequential();
            return;
          }
          // Hide all (do not reset "scored", so points aren't double-counted if re-revealed)
          setRevealed(new Array(current.answers.length).fill(false));
        }

        function nextMultiplier() {
          setMultiplier(m => (m === 1 ? 2 : m === 2 ? 3 : 1));
        }

        function addStrike() {
          setStrikes(s => Math.min(3, s + 1));
        }

        function clearStrikes() {
          setStrikes(0);
        }

        // Award: transfer Main Scoreboard to a team, clear mainScore
        function awardRound(to) {
          if (to === "A") setScoreA(s => s + mainScore);
          if (to === "B") setScoreB(s => s + mainScore);
          setMainScore(0);
        }

        function nextRound() {
          if (roundIndex < questions.length - 1) setRoundIndex(roundIndex + 1);
          else setRoundIndex(0);
        }

        function prevRound() {
          if (roundIndex > 0) setRoundIndex(roundIndex - 1);
        }

        function resetGame(hard = false) {
          setScoreA(0);
          setScoreB(0);
          setStrikes(0);
          setMultiplier(1);
          setMainScore(0);
          setRevealed(prev => prev.map(() => false));
          setScored(prev => prev.map(() => false));
          setQuestionHidden(true);
          setIsRevealingAll(false);
          if (hard) setRoundIndex(0);
        }

        function applyQuestionsJSON() {
          try {
            const parsed = JSON.parse(jsonDraft);
            if (!Array.isArray(parsed)) throw new Error("Root must be an array");
            parsed.forEach((q, idx) => {
              if (!q.prompt || !Array.isArray(q.answers)) {
                throw new Error("Item " + idx + " must have prompt and answers[]");
              }
              q.answers.forEach((a, j) => {
                if (typeof a.text !== "string" || typeof a.points !== "number") {
                  throw new Error("Answer " + j + " in question " + idx + " must have text:string and points:number");
                }
              });
            });
            setQuestions(parsed);
            setRoundIndex(0);
            setEditingQuestions(false);
          } catch (e) {
            alert("Invalid JSON: " + e.message);
          }
        }

        if (!current) {
          return (
            <div className="min-h-screen w-full bg-emerald-950 text-emerald-50 flex items-center justify-center p-6">
              <div className="max-w-xl w-full text-center">
                <div className="mx-auto mb-4 w-16 h-16 rounded-full bg-red-600" />
                <h1 className="text-3xl font-bold mb-2">BSA Family Feud Night</h1>
                <p className="opacity-80">No questions loaded. Add some below.</p>
                <button
                  className="mt-6 px-4 py-2 rounded-2xl bg-emerald-600 hover:bg-emerald-500 transition"
                  onClick={() => setQuestions(SAMPLE_QUESTIONS)}
                >
                  Load sample questions
                </button>
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen w-full bg-gradient-to-br from-emerald-950 via-emerald-900 to-emerald-950 text-emerald-50 p-4 md:p-8">
            <div className="max-w-6xl mx-auto space-y-4">
              <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div className="flex items-center gap-3">
                  <div className="w-8 h-8 rounded-full bg-red-600 shadow-md" />
                  <h1 className="text-3xl md:text-4xl font-extrabold tracking-tight">BSA Family Feud Night</h1>
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={() => setEditingQuestions(v => !v)} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">{editingQuestions ? "Close editor" : "Questions editor"}</button>
                  <button onClick={() => resetGame(true)} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Reset game</button>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 items-stretch">
                <div className="rounded-2xl bg-emerald-900/70 p-4 border border-emerald-800 shadow-sm">
                  <label className="text-xs uppercase tracking-wider opacity-70">Team A</label>
                  <input value={teamAName} onChange={e => setTeamAName(e.target.value)} className="w-full mt-1 bg-transparent outline-none border-b border-emerald-700 pb-1" />
                  <div className="mt-3 text-4xl font-bold tabular-nums">{scoreA}</div>
                </div>

                <div className="rounded-2xl bg-emerald-900/70 p-4 border border-emerald-800 shadow-sm flex flex-col gap-3">
                  <div className="flex items-center justify-between">
                    <div className="text-sm opacity-80">Round</div>
                    <div className="flex items-center gap-1">
                      <button onClick={prevRound} className="px-3 py-1 rounded-lg bg-emerald-800/60">◀</button>
                      <div className="px-3 py-1 rounded-lg bg-emerald-800/60 tabular-nums">{roundIndex + 1}/{questions.length}</div>
                      <button onClick={nextRound} className="px-3 py-1 rounded-lg bg-emerald-800/60">▶</button>
                    </div>
                  </div>
                  <div className="flex items-center justify-between">
                    <div className="text-sm opacity-80">Multiplier</div>
                    <button onClick={nextMultiplier} className="px-3 py-1 rounded-lg bg-emerald-800/60 font-semibold">×{multiplier}</button>
                  </div>

                  {/* MAIN SCOREBOARD */}
                  <div className="flex items-center justify-between border-t border-emerald-800/70 pt-3">
                    <div className="text-sm opacity-80">Main scoreboard</div>
                    <div className="text-2xl font-extrabold tabular-nums">{mainScore}</div>
                  </div>
                  <div className="text-xs opacity-70">
                    (Adds only on individual reveals • Reveal All doesn’t add points)
                  </div>
                </div>

                <div className="rounded-2xl bg-emerald-900/70 p-4 border border-emerald-800 shadow-sm">
                  <label className="text-xs uppercase tracking-wider opacity-70">Team B</label>
                  <input value={teamBName} onChange={e => setTeamBName(e.target.value)} className="w-full mt-1 bg-transparent outline-none border-b border-emerald-700 pb-1" />
                  <div className="mt-3 text-4xl font-bold tabular-nums">{scoreB}</div>
                </div>
              </div>

              <div className="relative rounded-2xl bg-gradient-to-br from-emerald-900 to-emerald-950 p-5 border border-emerald-800/80 shadow-md overflow-hidden">
                <div className="text-sm uppercase tracking-widest opacity-70">Question</div>

                {questionHidden ? (
                  <button
                    onClick={() => setQuestionHidden(false)}
                    className="mt-3 w-full rounded-2xl border-2 border-dashed border-emerald-700/80 bg-emerald-900/40 p-10 text-center hover:bg-emerald-900/60 transition"
                  >
                    <div className="flex flex-col items-center gap-3">
                      <div className="w-16 h-16 rounded-full bg-red-600 shadow" />
                      <div className="text-2xl md:text-3xl font-bold">Tap to reveal the question</div>
                      <div className="text-sm opacity-80">(Answers stay hidden until you click each tile)</div>
                    </div>
                  </button>
                ) : (
                  <>
                    <div className="mt-1 text-2xl md:text-3xl font-bold leading-snug">{current.prompt}</div>

                    <div className="mt-5 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                      {current.answers.map((ans, i) => (
                        <button
                          key={i}
                          onClick={() => handleReveal(i)}
                          className={`group relative rounded-2xl border border-emerald-800/70 p-4 text-left transition shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-emerald-950 ${
                            revealed[i] ? "bg-emerald-50 text-emerald-950" : "bg-emerald-950/40 text-emerald-50"
                          }`}
                          aria-pressed={revealed[i]}
                          disabled={isRevealingAll}
                        >
                          <div className="flex items-center justify-between gap-3">
                            <div className="font-semibold text-lg break-words">{revealed[i] ? ans.text : `#${i + 1}`}</div>
                            <div className={`rounded-xl px-3 py-1 text-sm tabular-nums ${
                              revealed[i] ? "bg-emerald-900 text-emerald-50" : "bg-emerald-800 text-emerald-100"
                            }`}>{revealed[i] ? ans.points : "?"}</div>
                          </div>
                        </button>
                      ))}
                    </div>
                  </>
                )}

                <div className="mt-6 flex flex-wrap items-center gap-2">
                  <button
                    onClick={() => toggleRevealAll(true)}
                    disabled={isRevealingAll}
                    className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Reveal all
                  </button>
                  <button
                    onClick={() => toggleRevealAll(false)}
                    disabled={isRevealingAll}
                    className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Hide all
                  </button>
                  <span className="mx-1 opacity-60">|</span>
                  <button onClick={() => awardRound("A")} className="px-3 py-2 rounded-xl bg-red-600 hover:bg-red-500">Award to {teamAName}</button>
                  <button onClick={() => awardRound("B")} className="px-3 py-2 rounded-xl bg-red-600 hover:bg-red-500">Award to {teamBName}</button>
                  <span className="mx-1 opacity-60">|</span>
                  <button onClick={prevRound} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Prev round</button>
                  <button onClick={nextRound} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Next round</button>
                </div>

                <div className="mt-4 h-2 w-full rounded-full bg-emerald-800 overflow-hidden">
                  <div className="h-full bg-red-600 transition-all" style={{ width: `${(revealed.filter(Boolean).length / (current?.answers.length || 1)) * 100}%` }} />
                </div>
                <div className="mt-2 text-xs opacity-70">Revealed {revealed.filter(Boolean).length}/{current.answers.length} • Total possible: {totalPossible}</div>
              </div>

              {editingQuestions && (
                <div className="rounded-2xl bg-emerald-950/60 border border-emerald-900 p-4">
                  <div className="flex items-center justify-between mb-2">
                    <h2 className="text-lg font-semibold">Questions editor (JSON)</h2>
                    <div className="flex gap-2">
                      <button onClick={() => setJsonDraft(JSON.stringify(questions, null, 2))} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Load current</button>
                      <button onClick={() => setJsonDraft(JSON.stringify(SAMPLE_QUESTIONS, null, 2))} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Load samples</button>
                      <button onClick={applyQuestionsJSON} className="px-3 py-2 rounded-xl bg-lime-500 hover:bg-lime-400 text-emerald-950 font-semibold">Save & apply</button>
                    </div>
                  </div>
                  <p className="text-sm opacity-75 mb-3">Paste or edit an array of objects with <code>prompt</code> and <code>answers[]</code> (each answer has <code>text</code> and <code>points</code> numbers).</p>
                  <textarea value={jsonDraft} onChange={e => setJsonDraft(e.target.value)} spellCheck={false} className="w-full h-72 md:h-96 p-3 rounded-xl bg-emerald-950/80 border border-emerald-800 font-mono text-sm" />
                </div>
              )}

              <div className="text-xs opacity-70 text-center py-2">Tip: Start each round by revealing the question. Use ×1/×2/×3 for double/triple rounds. Award points after a regular play or a steal.</div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<FamilyFeudLite />);
    </script>
  </body>
</html>
