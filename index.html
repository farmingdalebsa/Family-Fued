<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BSA Family Feud Night</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 UMD + Babel (so we can write JSX in-browser) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="min-h-screen bg-emerald-950">
    <div id="root"></div>

    <!-- Custom reveal sound: place your file at sounds/reveal.mp3 -->
    <audio id="reveal-audio" src="sounds/reveal.mp3" preload="auto"></audio>

    <script type="text/babel" data-presets="react">
      const { useMemo, useState, useEffect, useRef } = React;

      // First 21 questions are the updated set; last 4 kept from before.
      const SAMPLE_QUESTIONS = [
        // 1
        { prompt: "Name a popular Bangladeshi food", answers: [
          { text: "Biryani", points: 35 },
          { text: "Ilish Curry", points: 25 },
          { text: "Panta Ilish", points: 15 },
          { text: "Fuchka", points: 15 },
          { text: "Beef Curry", points: 10 },
        ]},
        // 2
        { prompt: "Name a Bangladeshi tourist spot", answers: [
          { text: "Cox’s Bazar", points: 40 },
          { text: "Sundarbans", points: 30 },
          { text: "Sylhet Tea Gardens", points: 15 },
          { text: "Sri Mangal", points: 10 },
          { text: "Lalbagh Fort", points: 5 },
        ]},
        // 3
        { prompt: "Name a Bangladeshi festival", answers: [
          { text: "Pohela Boishakh", points: 35 },
          { text: "Eid-ul-Fitr", points: 30 },
          { text: "Eid-ul-Adha", points: 20 },
          { text: "Durga Puja", points: 10 },
          { text: "Independence Day", points: 5 },
        ]},
        // 4
        { prompt: "Name a Bangladeshi sweet", answers: [
          { text: "Roshogolla", points: 30 },
          { text: "Mishti Doi", points: 25 },
          { text: "Chomchom", points: 20 },
          { text: "Sandesh", points: 15 },
          { text: "Kalo Jamun", points: 10 },
        ]},
        // 5
        { prompt: "Name a Bangladeshi river", answers: [
          { text: "Padma", points: 30 },
          { text: "Jamuna", points: 25 },
          { text: "Meghna", points: 20 },
          { text: "Buriganga", points: 15 },
          { text: "Teesta", points: 10 },
        ]},
        // 6
        { prompt: "Name something you see in Dhaka traffic", answers: [
          { text: "Rickshaw", points: 40 },
          { text: "Traffic Jam", points: 30 },
          { text: "CNG Auto", points: 15 },
          { text: "Street Vendors", points: 10 },
          { text: "Buses", points: 5 },
        ]},
        // 7
        { prompt: "Name something bought for Eid", answers: [
          { text: "New Clothes", points: 40 },
          { text: "Sweets", points: 25 },
          { text: "Shoes", points: 15 },
          { text: "Perfume/Attar", points: 10 },
          { text: "Cow/Goat", points: 10 },
        ]},
        // 8
        { prompt: "Name a Bangladeshi mode of village transport", answers: [
          { text: "Rickshaw", points: 35 },
          { text: "Bicycle", points: 20 },
          { text: "Motorbike", points: 20 },
          { text: "Paddle Van", points: 15 },
          { text: "Boat", points: 10 },
        ]},
        // 9
        { prompt: "Name something Bangladeshi families cook for special occasions", answers: [
          { text: "Biryani", points: 35 },
          { text: "Korma", points: 25 },
          { text: "Polao", points: 20 },
          { text: "Haleem", points: 10 },
          { text: "Shemai", points: 10 },
        ]},
        // 10
        { prompt: "Name a South Asian street food", answers: [
          { text: "Gol Gappa/Pani Puri/Fuchka", points: 40 },
          { text: "Chaat", points: 25 },
          { text: "Samosa", points: 20 },
          { text: "Vada Pav", points: 10 },
          { text: "Jhalmuri", points: 5 },
        ]},
        // 11
        { prompt: "Name a South Asian festival", answers: [
          { text: "Eid", points: 35 },
          { text: "Diwali", points: 30 },
          { text: "Holi", points: 15 },
          { text: "Durga Puja", points: 10 },
          { text: "Vaisakhi", points: 10 },
        ]},
        // 12
        { prompt: "Name a South Asian dessert", answers: [
          { text: "Gulab Jamun", points: 30 },
          { text: "Jalebi", points: 25 },
          { text: "Kheer/Payesh", points: 20 },
          { text: "Roshogolla", points: 15 },
          { text: "Kulfi", points: 10 },
        ]},
        // 13
        { prompt: "Name a South Asian movie star", answers: [
          { text: "Shah Rukh Khan", points: 30 },
          { text: "Salman Khan", points: 25 },
          { text: "Aamir Khan", points: 20 },
          { text: "Hania Amir", points: 15 },
          { text: "Mahira Khan", points: 10 },
        ]},
        // 14
        { prompt: "Name a South Asian cricket star", answers: [
          { text: "Virat Kohli", points: 30 },
          { text: "Shakib Al Hasan", points: 25 },
          { text: "Babar Azam", points: 20 },
          { text: "Dhoni", points: 15 },
          { text: "Shahid Afridi", points: 10 },
        ]},
        // 15
        { prompt: "Hardest class students complain about in Farmingdale", answers: [
          { text: "Calc 1 and Calc 2", points: 30 },
          { text: "Physics 1 and Physics 2", points: 25 },
          { text: "Chemistry", points: 20 },
          { text: "EET 105", points: 15 },
          { text: "Micro and Macro Economics", points: 10 },
        ]},
        // 16
        { prompt: "Where students go after class", answers: [
          { text: "Quintyne Hall", points: 30 },
          { text: "Cafeteria", points: 25 },
          { text: "Dorm", points: 20 },
          { text: "Shopping Area", points: 10 },
          { text: "Library", points: 10 },
        ]},
        // 17
        { prompt: "Name a popular MSA, PSA, SASA, ASA, BSA event", answers: [
          { text: "Formals Week", points: 30 },
          { text: "Pohela Boishakh", points: 20 },
          { text: "Eid Banquet", points: 25 },
          { text: "Game Night", points: 15 },
          { text: "Qawali night", points: 10 },
        ]},
        // 18
        { prompt: "Exam week essential for college students", answers: [
          { text: "Tea/Coffee", points: 28 },
          { text: "Instant noodles", points: 18 },
          { text: "Earbuds", points: 14 },
          { text: "Energy drink", points: 14 },
          { text: "Highlighters", points: 10 },
          { text: "Hoodie/blanket", points: 8 },
        ]},
        // 19
        { prompt: "Name something students stress about", answers: [
          { text: "Exams", points: 35 },
          { text: "Assignments", points: 25 },
          { text: "Tuition Fees", points: 20 },
          { text: "Job/Internship", points: 10 },
        ]},
        // 20
        { prompt: "What students do right before exams", answers: [
          { text: "Cram All Night", points: 35 },
          { text: "Drink Coffee", points: 25 },
          { text: "Group Study", points: 20 },
          { text: "Panic", points: 10 },
          { text: "Pray", points: 10 },
        ]},
        // 21
        { prompt: "Name a South Asian clothing item", answers: [
          { text: "Saree", points: 35 },
          { text: "Kurta", points: 25 },
          { text: "Salwar Kameez", points: 20 },
          { text: "Sherwani", points: 10 },
          { text: "Dhoti/Lungi", points: 10 },
        ]},

        /* 22–25: kept as before */
        { prompt: "Something people do at Eid prayer", answers: [
          { text: "Say Eid Mubarak", points: 26 },
          { text: "Shake hands/hug", points: 22 },
          { text: "Wear new clothes", points: 18 },
          { text: "Donate (Zakat)", points: 14 },
          { text: "Take photos", points: 10 },
        ]},
        { prompt: "A traditional Bangladeshi game", answers: [
          { text: "Kabaddi", points: 28 },
          { text: "Gollachut", points: 22 },
          { text: "Danguli", points: 18 },
          { text: "Ludo", points: 14 },
          { text: "Carrom", points: 10 },
        ]},
        { prompt: "Something Bangladeshi students miss from home", answers: [
          { text: "Family", points: 28 },
          { text: "Home food", points: 24 },
          { text: "Friends", points: 18 },
          { text: "Festivals", points: 14 },
          { text: "Weather", points: 10 },
        ]},
        { prompt: "A Bangladeshi word Americans often mispronounce", answers: [
          { text: "Dhaka", points: 26 },
          { text: "Sylhet", points: 22 },
          { text: "Chittagong", points: 18 },
          { text: "Pohela Boishakh", points: 14 },
          { text: "Ilish", points: 10 },
        ]},
      ];

      function FamilyFeudLite() {
        const [teamAName, setTeamAName] = useState("Team Padma");
        const [teamBName, setTeamBName] = useState("Team Meghna");
        const [scoreA, setScoreA] = useState(0);
        const [scoreB, setScoreB] = useState(0);

        const [questions, setQuestions] = useState(SAMPLE_QUESTIONS);
        const [roundIndex, setRoundIndex] = useState(0);

        // Per-round reveal & scoring
        const [revealed, setRevealed] = useState([]);   // which tiles are visible
        const [scored, setScored] = useState([]);       // which tiles already added to mainScore
        const [mainScore, setMainScore] = useState(0);  // MAIN SCOREBOARD (current round)

        const [strikes, setStrikes] = useState(0);
        const [multiplier, setMultiplier] = useState(1);
        const [editingQuestions, setEditingQuestions] = useState(false);
        const [jsonDraft, setJsonDraft] = useState(() => JSON.stringify(SAMPLE_QUESTIONS, null, 2));
        const [questionHidden, setQuestionHidden] = useState(true);
        const [isRevealingAll, setIsRevealingAll] = useState(false);

        // Reveal sound
        const revealAudioRef = useRef(null);
        useEffect(() => {
          revealAudioRef.current = document.getElementById("reveal-audio");
        }, []);
        function playReveal(delayMs = 0, volume = 1) {
          const el = revealAudioRef.current;
          if (!el) return;
          const node = el.cloneNode(true);
          node.volume = volume;
          setTimeout(() => { node.play().catch(() => {}); }, delayMs);
        }
        function sleep(ms) { return new Promise(res => setTimeout(res, ms)); }

        const current = questions[roundIndex];

        // Initialize new round
        useEffect(() => {
          if (!current) return;
          const n = current.answers.length;
          setRevealed(Array(n).fill(false));
          setScored(Array(n).fill(false));
          setMainScore(0);
          setStrikes(0);
          setMultiplier(1);
          setQuestionHidden(true);
          setIsRevealingAll(false);
        }, [roundIndex, questions]);

        const totalPossible = useMemo(() => {
          if (!current) return 0;
          return current.answers.reduce((s, a) => s + a.points, 0);
        }, [current]);

        // Single tile reveal: adds points to Main Scoreboard (once per tile), honors multiplier
        function handleReveal(i) {
          if (questionHidden || isRevealingAll) return;
          if (!revealed[i]) {
            setRevealed(prev => {
              const next = [...prev];
              next[i] = true;
              return next;
            });
            setScored(prev => {
              if (!prev[i]) {
                setMainScore(ms => ms + current.answers[i].points * multiplier);
                const next = [...prev];
                next[i] = true;
                return next;
              }
              return prev;
            });
            playReveal(0, 0.95);
          }
        }

        // Reveal all sequentially: NO scoring, just reveal + sound
        async function revealAllSequential() {
          if (!current || isRevealingAll) return;
          setIsRevealingAll(true);
          setQuestionHidden(false);

          const toReveal = current.answers.map((_, i) => i).filter(i => !revealed[i]);
          for (const idx of toReveal) {
            setRevealed(prev => {
              const next = [...prev];
              next[idx] = true;
              return next;
            });
            // No scored/mainScore changes here
            playReveal(0, 0.95);
            await sleep(250); // change to 3000 for a 3s delay
          }
          setIsRevealingAll(false);
        }

        function toggleRevealAll(state) {
          if (!current) return;
          if (state) {
            revealAllSequential();
            return;
          }
          // Hide all (do not reset "scored", so points aren't double-counted if re-revealed)
          setRevealed(new Array(current.answers.length).fill(false));
        }

        function nextMultiplier() {
          setMultiplier(m => (m === 1 ? 2 : m === 2 ? 3 : 1));
        }

        function addStrike() {
          setStrikes(s => Math.min(3, s + 1));
        }

        function clearStrikes() {
          setStrikes(0);
        }

        // Award: transfer Main Scoreboard to a team, clear mainScore
        function awardRound(to) {
          if (to === "A") setScoreA(s => s + mainScore);
          if (to === "B") setScoreB(s => s + mainScore);
          setMainScore(0);
        }

        function nextRound() {
          if (roundIndex < questions.length - 1) setRoundIndex(roundIndex + 1);
          else setRoundIndex(0);
        }

        function prevRound() {
          if (roundIndex > 0) setRoundIndex(roundIndex - 1);
        }

        function resetGame(hard = false) {
          setScoreA(0);
          setScoreB(0);
          setStrikes(0);
          setMultiplier(1);
          setMainScore(0);
          setRevealed(prev => prev.map(() => false));
          setScored(prev => prev.map(() => false));
          setQuestionHidden(true);
          setIsRevealingAll(false);
          if (hard) setRoundIndex(0);
        }

        function applyQuestionsJSON() {
          try {
            const parsed = JSON.parse(jsonDraft);
            if (!Array.isArray(parsed)) throw new Error("Root must be an array");
            parsed.forEach((q, idx) => {
              if (!q.prompt || !Array.isArray(q.answers)) {
                throw new Error("Item " + idx + " must have prompt and answers[]");
              }
              q.answers.forEach((a, j) => {
                if (typeof a.text !== "string" || typeof a.points !== "number") {
                  throw new Error("Answer " + j + " in question " + idx + " must have text:string and points:number");
                }
              });
            });
            setQuestions(parsed);
            setRoundIndex(0);
            setEditingQuestions(false);
          } catch (e) {
            alert("Invalid JSON: " + e.message);
          }
        }

        if (!current) {
          return (
            <div className="min-h-screen w-full bg-emerald-950 text-emerald-50 flex items-center justify-center p-6">
              <div className="max-w-xl w-full text-center">
                <div className="mx-auto mb-4 w-16 h-16 rounded-full bg-red-600" />
                <h1 className="text-3xl font-bold mb-2">BSA Family Feud Night</h1>
                <p className="opacity-80">No questions loaded. Add some below.</p>
                <button
                  className="mt-6 px-4 py-2 rounded-2xl bg-emerald-600 hover:bg-emerald-500 transition"
                  onClick={() => setQuestions(SAMPLE_QUESTIONS)}
                >
                  Load sample questions
                </button>
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen w-full bg-gradient-to-br from-emerald-950 via-emerald-900 to-emerald-950 text-emerald-50 p-4 md:p-8">
            <div className="max-w-6xl mx-auto space-y-4">
              <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div className="flex items-center gap-3">
                  <div className="w-8 h-8 rounded-full bg-red-600 shadow-md" />
                  <h1 className="text-3xl md:text-4xl font-extrabold tracking-tight">BSA Family Feud Night</h1>
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={() => setEditingQuestions(v => !v)} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">{editingQuestions ? "Close editor" : "Questions editor"}</button>
                  <button onClick={() => resetGame(true)} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Reset game</button>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 items-stretch">
                <div className="rounded-2xl bg-emerald-900/70 p-4 border border-emerald-800 shadow-sm">
                  <label className="text-xs uppercase tracking-wider opacity-70">Team A</label>
                  <input value={teamAName} onChange={e => setTeamAName(e.target.value)} className="w-full mt-1 bg-transparent outline-none border-b border-emerald-700 pb-1" />
                  <div className="mt-3 text-4xl font-bold tabular-nums">{scoreA}</div>
                </div>

                <div className="rounded-2xl bg-emerald-900/70 p-4 border border-emerald-800 shadow-sm flex flex-col gap-3">
                  <div className="flex items-center justify-between">
                    <div className="text-sm opacity-80">Round</div>
                    <div className="flex items-center gap-1">
                      <button onClick={prevRound} className="px-3 py-1 rounded-lg bg-emerald-800/60">◀</button>
                      <div className="px-3 py-1 rounded-lg bg-emerald-800/60 tabular-nums">{roundIndex + 1}/{questions.length}</div>
                      <button onClick={nextRound} className="px-3 py-1 rounded-lg bg-emerald-800/60">▶</button>
                    </div>
                  </div>
                  <div className="flex items-center justify-between">
                    <div className="text-sm opacity-80">Multiplier</div>
                    <button onClick={nextMultiplier} className="px-3 py-1 rounded-lg bg-emerald-800/60 font-semibold">×{multiplier}</button>
                  </div>

                  {/* MAIN SCOREBOARD */}
                  <div className="flex items-center justify-between border-t border-emerald-800/70 pt-3">
                    <div className="text-sm opacity-80">Main scoreboard</div>
                    <div className="text-2xl font-extrabold tabular-nums">{mainScore}</div>
                  </div>
                  <div className="text-xs opacity-70">
                    (Adds only on individual reveals • Reveal All doesn’t add points)
                  </div>
                </div>

                <div className="rounded-2xl bg-emerald-900/70 p-4 border border-emerald-800 shadow-sm">
                  <label className="text-xs uppercase tracking-wider opacity-70">Team B</label>
                  <input value={teamBName} onChange={e => setTeamBName(e.target.value)} className="w-full mt-1 bg-transparent outline-none border-b border-emerald-700 pb-1" />
                  <div className="mt-3 text-4xl font-bold tabular-nums">{scoreB}</div>
                </div>
              </div>

              <div className="relative rounded-2xl bg-gradient-to-br from-emerald-900 to-emerald-950 p-5 border border-emerald-800/80 shadow-md overflow-hidden">
                <div className="text-sm uppercase tracking-widest opacity-70">Question</div>

                {questionHidden ? (
                  <button
                    onClick={() => setQuestionHidden(false)}
                    className="mt-3 w-full rounded-2xl border-2 border-dashed border-emerald-700/80 bg-emerald-900/40 p-10 text-center hover:bg-emerald-900/60 transition"
                  >
                    <div className="flex flex-col items-center gap-3">
                      <div className="w-16 h-16 rounded-full bg-red-600 shadow" />
                      <div className="text-2xl md:text-3xl font-bold">Tap to reveal the question</div>
                      <div className="text-sm opacity-80">(Answers stay hidden until you click each tile)</div>
                    </div>
                  </button>
                ) : (
                  <>
                    <div className="mt-1 text-2xl md:text-3xl font-bold leading-snug">{current.prompt}</div>

                    <div className="mt-5 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                      {current.answers.map((ans, i) => (
                        <button
                          key={i}
                          onClick={() => handleReveal(i)}
                          className={`group relative rounded-2xl border border-emerald-800/70 p-4 text-left transition shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-emerald-950 ${
                            revealed[i] ? "bg-emerald-50 text-emerald-950" : "bg-emerald-950/40 text-emerald-50"
                          }`}
                          aria-pressed={revealed[i]}
                          disabled={isRevealingAll}
                        >
                          <div className="flex items-center justify-between gap-3">
                            <div className="font-semibold text-lg break-words">{revealed[i] ? ans.text : `#${i + 1}`}</div>
                            <div className={`rounded-xl px-3 py-1 text-sm tabular-nums ${
                              revealed[i] ? "bg-emerald-900 text-emerald-50" : "bg-emerald-800 text-emerald-100"
                            }`}>{revealed[i] ? ans.points : "?"}</div>
                          </div>
                        </button>
                      ))}
                    </div>
                  </>
                )}

                <div className="mt-6 flex flex-wrap items-center gap-2">
                  <button
                    onClick={() => toggleRevealAll(true)}
                    disabled={isRevealingAll}
                    className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Reveal all
                  </button>
                  <button
                    onClick={() => toggleRevealAll(false)}
                    disabled={isRevealingAll}
                    className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Hide all
                  </button>
                  <span className="mx-1 opacity-60">|</span>
                  <button onClick={() => awardRound("A")} className="px-3 py-2 rounded-xl bg-red-600 hover:bg-red-500">Award to {teamAName}</button>
                  <button onClick={() => awardRound("B")} className="px-3 py-2 rounded-xl bg-red-600 hover:bg-red-500">Award to {teamBName}</button>
                  <span className="mx-1 opacity-60">|</span>
                  <button onClick={prevRound} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Prev round</button>
                  <button onClick={nextRound} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Next round</button>
                </div>

                <div className="mt-4 h-2 w-full rounded-full bg-emerald-800 overflow-hidden">
                  <div className="h-full bg-red-600 transition-all" style={{ width: `${(revealed.filter(Boolean).length / (current?.answers.length || 1)) * 100}%` }} />
                </div>
                <div className="mt-2 text-xs opacity-70">Revealed {revealed.filter(Boolean).length}/{current.answers.length} • Total possible: {totalPossible}</div>
              </div>

              {editingQuestions && (
                <div className="rounded-2xl bg-emerald-950/60 border border-emerald-900 p-4">
                  <div className="flex items-center justify-between mb-2">
                    <h2 className="text-lg font-semibold">Questions editor (JSON)</h2>
                    <div className="flex gap-2">
                      <button onClick={() => setJsonDraft(JSON.stringify(questions, null, 2))} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Load current</button>
                      <button onClick={() => setJsonDraft(JSON.stringify(SAMPLE_QUESTIONS, null, 2))} className="px-3 py-2 rounded-xl bg-emerald-800/60 hover:bg-emerald-800 border border-emerald-700">Load samples</button>
                      <button onClick={applyQuestionsJSON} className="px-3 py-2 rounded-xl bg-lime-500 hover:bg-lime-400 text-emerald-950 font-semibold">Save & apply</button>
                    </div>
                  </div>
                  <p className="text-sm opacity-75 mb-3">Paste or edit an array of objects with <code>prompt</code> and <code>answers[]</code> (each answer has <code>text</code> and <code>points</code> numbers).</p>
                  <textarea value={jsonDraft} onChange={e => setJsonDraft(e.target.value)} spellCheck={false} className="w-full h-72 md:h-96 p-3 rounded-xl bg-emerald-950/80 border border-emerald-800 font-mono text-sm" />
                </div>
              )}

              <div className="text-xs opacity-70 text-center py-2">Tip: Start each round by revealing the question. Use ×1/×2/×3 for double/triple rounds. Award points after a regular play or a steal.</div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<FamilyFeudLite />);
    </script>
  </body>
</html>
